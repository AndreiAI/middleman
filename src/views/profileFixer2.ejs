<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    
    <link rel="stylesheet" href="/css/handler.css">

    <title>Middleman</title>    
</head>

<body>
    <form action="/auth/logOut" method="post">
        <input type="submit" value="Log out">
    </form>
    <div class="priorityRed">
        <img class="backgroundImg" src="/img/rectangle.png"/>
        <h1>
            Red
        </h1>
        <%for (var i = 0; i < problems.length; i ++) {%>
            <%if(problems[i].status === 'onGoing' && problems[i].priority === 'red') {%>
                <details class="onGoingDetails">
                    <summary>
                        <%=problems[i].summary%>
                            -
                            <%=problems[i]._id%>
                    </summary>
                    <p>
                        Description:
                        <%=problems[i].description%>
                    </p>
                    <p>
                        Address:
                        <%=JSON.stringify(problems[i].address)%>
                    </p>
                    <p>
                        Phone:
                        <%=problems[i].phone%>
                    </p>
                    <p>
                        Type:
                        <%=problems[i].type%>
                    </p>
                    <p>
                        Fixer:
                        <%=problems[i].fixer%>
                    </p>
                    <p>
                        Deadline:
                        <%=problems[i].deadline%>
                    </p>
                    <form action="/problem/<%= problems[i]._id %>" method="get">
                        <input type='submit' value='Details' />
                    </form>
                </details>
                <div class="onGoingOptions">
                </div>
                <%}}%>
    </div>
    <div class="priorityYellow">
        <img class="backgroundImg" src="/img/rectangle.png"/>
        <h1>
            Yellow
        </h1>
        <%for (var i = 0; i < problems.length; i ++) {%>
            <%if(problems[i].status === 'onGoing' && problems[i].priority === 'yellow') {%>
                <details class="onGoingDetails">
                    <summary>
                        <%=problems[i].summary%>
                            -
                            <%=problems[i]._id%>
                    </summary>
                    <p>
                        Description:
                        <%=problems[i].description%>
                    </p>
                    <p>
                        Address:
                        <%=JSON.stringify(problems[i].address)%>
                    </p>
                    <p>
                        Phone:
                        <%=problems[i].phone%>
                    </p>
                    <p>
                        Type:
                        <%=problems[i].type%>
                    </p>
                    <p>
                        Fixer:
                        <%=problems[i].fixer%>
                    </p>
                    <p>
                        Deadline:
                        <%=problems[i].deadline%>
                    </p>
                    <form action="/problem/<%= problems[i]._id %>" method="get">
                        <input type='submit' value='Details' />
                    </form>
                </details>
                <div class="onGoingOptions">
                </div>
                <%}}%>
    </div>
    <div class="priorityGreen">
        <img class="backgroundImg" src="/img/rectangle.png"/>
        <h1>
            Green
        </h1>
        <%for (var i = 0; i < problems.length; i ++) {%>
            <%if(problems[i].status === 'onGoing' && problems[i].priority === 'green') {%>
                <details class="onGoingDetails">
                    <summary>
                        <%=problems[i].summary%>
                            -
                            <%=problems[i]._id%>
                    </summary>
                    <p>
                        Description:
                        <%=problems[i].description%>
                    </p>
                    <p>
                        Address:
                        <%=JSON.stringify(problems[i].address)%>
                    </p>
                    <p>
                        Phone:
                        <%=problems[i].phone%>
                    </p>
                    <p>
                        Type:
                        <%=problems[i].type%>
                    </p>
                    <p>
                        Fixer:
                        <%=problems[i].fixer%>
                    </p>
                    <p>
                        Deadline:
                        <%=problems[i].deadline%>
                    </p>
                    <form action="/problem/<%= problems[i]._id %>" method="get">
                        <input type='submit' value='Details' />
                    </form>
                </details>
                <div class="onGoingOptions">
                </div>
                <%}}%>
    </div>
    <div class="lastUpdates">
        <img class="backgroundImg" src="/img/rectangle.png"/>
        <h1>
            Last updates
        </h1>
        <% if(problems != null) { %>
            <% problems.forEach(function(problem){ %>
                <% if(problem.status !== 'completed') { %>
                    <% if(updates[problem._id] != null && updates[problem._id].length > 0) { %>
                        <form action="/problem/<%= problem._id %>" method="get">
                            <input type='submit' value='<%= problem.summary %> (<%= problem._id %>)' />
                        </form>
                        <% updates[problem._id].sort(function(a, b) {return b.totalTime - a.totalTime;}); %>
                        <% for(var i = 0; i < Math.min(2, updates[problem._id].length); i ++) {%>
                            <p>
                                <%= updates[problem._id][i].timestamp %> - <%= updates[problem._id][i].author %>: <%= updates[problem._id][i].update %>
                            </p>
                        <% } %>
                    <% } %>
                <% } %>
            <% }); %>
        <% } %>
    </div>
    <form id="completed" action="/auth/completed" method="get">
        <input type="submit" value="Completed">
    </form>
</body>

</html>
